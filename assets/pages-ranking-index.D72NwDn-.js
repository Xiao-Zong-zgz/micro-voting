import{t as a,s as e,l as t,p as s,c as l,w as n,i,o as r,a as o,b as c,d,n as u,f,r as p,F as h,e as _,g,j as C,I as k,h as m}from"./index-DwyDR4I6.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=b({data:()=>({rankingData:[],searchQuery:"",sortOptions:["按分数排序","按名称排序"],sortIndex:0,viewMode:"list",lastUpdated:"--:--:--",refreshing:!1,displayCount:20,hasMore:!0}),computed:{filteredRanking(){let a=this.rankingData.filter((a=>a.name.toLowerCase().includes(this.searchQuery.toLowerCase())||a.field.toLowerCase().includes(this.searchQuery.toLowerCase())));return 0===this.sortIndex?a.sort(((a,e)=>e.finalScore-a.finalScore)):a.sort(((a,e)=>a.name.localeCompare(e.name))),a.slice(0,this.displayCount)},expertCount(){return this.rankingData.reduce(((a,e)=>Math.max(a,e.expertCount||0)),0)},publicCount(){return this.rankingData.reduce(((a,e)=>Math.max(a,e.publicCount||0)),0)}},methods:{onSortChange(a){this.sortIndex=a.detail.value},onSearch(){this.displayCount=20,this.hasMore=this.rankingData.length>20},async refreshRanking(){this.refreshing=!0,console.log("开始获取排名数据...");try{const t=await a.callFunction({name:"vote-system",data:{action:"getRanking",data:{limit:100}}});if(console.log("云函数返回结果:",t),200!==t.result.code)throw new Error(t.result.message);this.rankingData=t.result.data,this.lastUpdated=this.formatTime(new Date),this.hasMore=this.rankingData.length>this.displayCount,e({title:"排名已更新",icon:"success"})}catch(t){console.error("获取排名失败:",t),this.useMockData(),e({title:"使用模拟数据",icon:"none"})}finally{this.refreshing=!1}},useMockData(){this.rankingData=[{id:1,name:"智能农业监测系统",field:"农业科技",finalScore:85.6,expertCount:25,publicCount:45},{id:2,name:"医疗AI诊断平台",field:"医疗健康",finalScore:82.3,expertCount:28,publicCount:42},{id:3,name:"智慧城市解决方案",field:"城市管理",finalScore:78.9,expertCount:22,publicCount:38},{id:4,name:"新能源汽车技术",field:"汽车工业",finalScore:76.5,expertCount:26,publicCount:40},{id:5,name:"区块链金融平台",field:"金融服务",finalScore:74.2,expertCount:24,publicCount:36},{id:6,name:"在线教育平台",field:"教育培训",finalScore:72.8,expertCount:20,publicCount:35},{id:7,name:"智能家居系统",field:"智能硬件",finalScore:70.1,expertCount:23,publicCount:37},{id:8,name:"环保新材料",field:"材料科学",finalScore:68.7,expertCount:21,publicCount:33},{id:9,name:"生物医药研发",field:"生物技术",finalScore:66.4,expertCount:19,publicCount:32},{id:10,name:"无人机物流",field:"物流运输",finalScore:64.2,expertCount:18,publicCount:30},{id:11,name:"虚拟现实应用",field:"数字娱乐",finalScore:62.8,expertCount:17,publicCount:29},{id:12,name:"人工智能助手",field:"软件开发",finalScore:60.5,expertCount:16,publicCount:28}],this.lastUpdated=this.formatTime(new Date)+" (模拟数据)",this.hasMore=this.rankingData.length>this.displayCount},loadMore(){this.displayCount+=20,this.hasMore=this.rankingData.length>this.displayCount},exportRanking(){if(0===this.rankingData.length)return void e({title:"暂无数据可导出",icon:"none"});const a=["排名,项目名称,领域,总分,专家评委数,大众评委数",...this.filteredRanking.map(((a,e)=>`${e+1},${a.name},${a.field},${a.finalScore.toFixed(2)},${a.expertCount||0},${a.publicCount||0}`))].join("\n");t({data:a,success:()=>{e({title:"排名数据已复制到剪贴板",icon:"success"})}})},formatTime:a=>`${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`},onLoad(){this.refreshRanking(),this.autoRefresh=setInterval((()=>{this.refreshRanking()}),3e4)},onUnload(){this.autoRefresh&&clearInterval(this.autoRefresh)},onPullDownRefresh(){this.refreshRanking().finally((()=>{s()}))}},[["render",function(a,e,t,s,b,x){const y=g,S=i,v=C,w=k,M=m;return r(),l(S,{class:"container"},{default:n((()=>[o(S,{class:"header uni-card"},{default:n((()=>[o(S,{class:"header-main"},{default:n((()=>[o(y,{class:"title"},{default:n((()=>[c("项目排名")])),_:1}),o(y,{class:"subtitle"},{default:n((()=>[c("实时更新，公平公正")])),_:1})])),_:1}),o(S,{class:"header-actions"},{default:n((()=>[o(v,{onClick:x.refreshRanking,class:"uni-btn uni-btn-primary refresh-btn"},{default:n((()=>[o(y,{class:"btn-text"},{default:n((()=>[c(d(b.refreshing?"更新中...":"刷新排名"),1)])),_:1})])),_:1},8,["onClick"]),o(v,{onClick:x.exportRanking,class:"uni-btn uni-btn-success export-btn"},{default:n((()=>[o(y,{class:"btn-text"},{default:n((()=>[c("导出排名")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),o(S,{class:"stats-cards"},{default:n((()=>[o(S,{class:"stat-card uni-card"},{default:n((()=>[o(S,{class:"stat-icon"},{default:n((()=>[c("🏆")])),_:1}),o(y,{class:"stat-value"},{default:n((()=>[c(d(b.rankingData.length),1)])),_:1}),o(y,{class:"stat-label"},{default:n((()=>[c("参赛项目")])),_:1})])),_:1}),o(S,{class:"stat-card uni-card"},{default:n((()=>[o(S,{class:"stat-icon"},{default:n((()=>[c("👨‍💼")])),_:1}),o(y,{class:"stat-value"},{default:n((()=>[c(d(x.expertCount),1)])),_:1}),o(y,{class:"stat-label"},{default:n((()=>[c("专家评委")])),_:1})])),_:1}),o(S,{class:"stat-card uni-card"},{default:n((()=>[o(S,{class:"stat-icon"},{default:n((()=>[c("👥")])),_:1}),o(y,{class:"stat-value"},{default:n((()=>[c(d(x.publicCount),1)])),_:1}),o(y,{class:"stat-label"},{default:n((()=>[c("大众评委")])),_:1})])),_:1}),o(S,{class:"stat-card uni-card"},{default:n((()=>[o(S,{class:"stat-icon"},{default:n((()=>[c("🕒")])),_:1}),o(y,{class:"stat-value"},{default:n((()=>[c(d(b.lastUpdated),1)])),_:1}),o(y,{class:"stat-label"},{default:n((()=>[c("最后更新")])),_:1})])),_:1})])),_:1}),o(S,{class:"filters-section uni-card"},{default:n((()=>[o(S,{class:"search-box"},{default:n((()=>[o(w,{modelValue:b.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=a=>b.searchQuery=a),class:"search-input",placeholder:"搜索项目名称...",onInput:x.onSearch},null,8,["modelValue","onInput"]),o(y,{class:"search-icon"},{default:n((()=>[c("🔍")])),_:1})])),_:1}),o(S,{class:"filter-options"},{default:n((()=>[o(M,{onChange:x.onSortChange,value:b.sortIndex,range:b.sortOptions,class:"sort-picker"},{default:n((()=>[o(S,{class:"picker-display"},{default:n((()=>[o(y,null,{default:n((()=>[c(d(b.sortOptions[b.sortIndex]),1)])),_:1}),o(y,{class:"picker-arrow"},{default:n((()=>[c("▼")])),_:1})])),_:1})])),_:1},8,["onChange","value","range"]),o(S,{class:"view-toggle"},{default:n((()=>[o(y,{class:u(["view-option",{active:"list"===b.viewMode}]),onClick:e[1]||(e[1]=a=>b.viewMode="list")},{default:n((()=>[c(" 列表 ")])),_:1},8,["class"]),o(y,{class:u(["view-option",{active:"card"===b.viewMode}]),onClick:e[2]||(e[2]=a=>b.viewMode="card")},{default:n((()=>[c(" 卡片 ")])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),o(S,{class:"ranking-content"},{default:n((()=>["list"===b.viewMode?(r(),l(S,{key:0,class:"ranking-list"},{default:n((()=>[(r(!0),f(h,null,p(x.filteredRanking,((a,e)=>(r(),l(S,{key:a.id,class:u(["ranking-item",{"first-place":0===e,"second-place":1===e,"third-place":2===e,"top-rank":e<12}])},{default:n((()=>[o(S,{class:"rank-badge"},{default:n((()=>[o(y,{class:"rank-number"},{default:n((()=>[c(d(e+1),1)])),_:2},1024)])),_:2},1024),o(S,{class:"project-info"},{default:n((()=>[o(y,{class:"project-name"},{default:n((()=>[c(d(a.name),1)])),_:2},1024),o(y,{class:"project-field"},{default:n((()=>[c(d(a.field),1)])),_:2},1024),o(S,{class:"project-stats"},{default:n((()=>[o(y,{class:"stat-item"},{default:n((()=>[c("专家: "+d(a.expertCount||0)+"人",1)])),_:2},1024),o(y,{class:"stat-item"},{default:n((()=>[c("大众: "+d(a.publicCount||0)+"人",1)])),_:2},1024)])),_:2},1024)])),_:2},1024),o(S,{class:"score-display"},{default:n((()=>[o(y,{class:"score-value"},{default:n((()=>[c(d(a.finalScore.toFixed(2)),1)])),_:2},1024),o(y,{class:"score-label"},{default:n((()=>[c("总分")])),_:1})])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1})):_("",!0),"card"===b.viewMode?(r(),l(S,{key:1,class:"ranking-cards"},{default:n((()=>[(r(!0),f(h,null,p(x.filteredRanking,((a,e)=>(r(),l(S,{key:a.id,class:u(["ranking-card",{"gold-card":0===e,"silver-card":1===e,"bronze-card":2===e}])},{default:n((()=>[o(S,{class:"card-header"},{default:n((()=>[o(S,{class:"card-rank"},{default:n((()=>[o(y,{class:"rank-text"},{default:n((()=>[c("第"+d(e+1)+"名",1)])),_:2},1024)])),_:2},1024),o(S,{class:"card-score"},{default:n((()=>[o(y,{class:"score-text"},{default:n((()=>[c(d(a.finalScore.toFixed(2)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),o(S,{class:"card-body"},{default:n((()=>[o(y,{class:"card-title"},{default:n((()=>[c(d(a.name),1)])),_:2},1024),o(y,{class:"card-subtitle"},{default:n((()=>[c(d(a.field),1)])),_:2},1024)])),_:2},1024),o(S,{class:"card-footer"},{default:n((()=>[o(S,{class:"stat-badges"},{default:n((()=>[o(S,{class:"stat-badge expert"},{default:n((()=>[o(y,{class:"badge-text"},{default:n((()=>[c("专家 "+d(a.expertCount||0),1)])),_:2},1024)])),_:2},1024),o(S,{class:"stat-badge public"},{default:n((()=>[o(y,{class:"badge-text"},{default:n((()=>[c("大众 "+d(a.publicCount||0),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1})):_("",!0),0===x.filteredRanking.length?(r(),l(S,{key:2,class:"empty-state"},{default:n((()=>[o(S,{class:"empty-icon"},{default:n((()=>[c("📊")])),_:1}),o(y,{class:"empty-title"},{default:n((()=>[c("暂无排名数据")])),_:1}),o(y,{class:"empty-desc"},{default:n((()=>[c("请等待评委评分或刷新页面")])),_:1}),o(v,{onClick:x.refreshRanking,class:"uni-btn uni-btn-primary load-btn"},{default:n((()=>[c(" 刷新数据 ")])),_:1},8,["onClick"])])),_:1})):_("",!0)])),_:1}),x.filteredRanking.length>0&&b.hasMore?(r(),l(S,{key:0,class:"load-more"},{default:n((()=>[o(v,{onClick:x.loadMore,class:"uni-btn uni-btn-warning more-btn"},{default:n((()=>[c(" 加载更多 ")])),_:1},8,["onClick"])])),_:1})):_("",!0),o(S,{class:"footer-info"},{default:n((()=>[o(y,{class:"footer-text"},{default:n((()=>[c("数据每30秒自动更新 • 最终解释权归主办方所有")])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-40921d4f"]]);export{x as default};

import{t as e,s as t,c as s,w as a,i as r,o as n,a as c,b as l,d as o,e as i,f as u,r as d,F as p,g as m,I as f,h,j as y,S as _,n as j}from"./index-DwyDR4I6.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=I({data:()=>({userInfo:{verified:!1,username:"",phone:"",userType:""},usernameInput:"",phoneInput:"",userTypes:["专家组","大众组"],userTypeIndex:0,projects:[],currentProject:null,criteria:[{name:"技术创新性",maxScore:30,description:"技术的创新程度和独特性",score:null},{name:"商业模式",maxScore:25,description:"商业模式的可行性和市场前景",score:null},{name:"团队能力",maxScore:20,description:"团队的专业能力和执行经验",score:null},{name:"路演表现",maxScore:15,description:"路演的表达能力和现场表现",score:null},{name:"社会价值",maxScore:10,description:"项目的社会影响和价值",score:null}]}),computed:{currentTotalScore(){return this.criteria.reduce(((e,t)=>e+(Number(t.score)||0)),0)},canSubmit(){return this.criteria.every((e=>null!==e.score&&""!==e.score&&e.score>=0))}},methods:{onUserTypeChange(e){this.userTypeIndex=e.detail.value},async testConnection(){try{const s=await e.callFunction({name:"vote-system",data:{action:"testConnection"}});t({title:s.result.message,icon:"success"})}catch(s){t({title:"连接测试失败",icon:"none"})}},async verifyIdentity(){if(!this.usernameInput.trim())return void t({title:"请输入姓名",icon:"none"});if(/^1[3-9]\d{9}$/.test(this.phoneInput))try{const s={name:this.usernameInput.trim(),phone:this.phoneInput,userType:"专家组"===this.userTypes[this.userTypeIndex]?"expert":"public"},a=await e.callFunction({name:"vote-system",data:{action:"verifyUser",data:s}});200===a.result.code?(this.userInfo={verified:!0,username:a.result.data.name,phone:a.result.data.phone,userType:a.result.data.userType,userId:a.result.data.userId},await this.loadProjects(),t({title:"身份验证成功！",icon:"success"})):t({title:a.result.message,icon:"none"})}catch(s){console.error("验证失败:",s),t({title:"验证失败，请重试",icon:"none"})}else t({title:"请输入有效的手机号",icon:"none"})},async loadProjects(){try{const t=await e.callFunction({name:"vote-system",data:{action:"getProjects"}});200===t.result.code&&(this.projects=t.result.data,this.projects.length>0&&(this.currentProject=this.projects[0]))}catch(s){console.error("加载项目失败:",s),t({title:"加载项目失败",icon:"none"})}},selectProject(e){this.currentProject=e,this.criteria.forEach((e=>{e.score=null}))},validateScore(e){e.score>e.maxScore?e.score=e.maxScore:e.score<0&&(e.score=0)},async submitScore(){if(this.canSubmit)try{const s={userId:this.userInfo.userId,projectId:this.currentProject.id,userType:this.userInfo.userType,scores:this.criteria.map((e=>({criterion:e.name,score:Number(e.score)}))),totalScore:this.currentTotalScore},a=await e.callFunction({name:"vote-system",data:{action:"submitScore",data:s}});if(200===a.result.code){t({title:"评分提交成功！",icon:"success"}),this.criteria.forEach((e=>{e.score=null}));const e=(this.projects.findIndex((e=>e.id===this.currentProject.id))+1)%this.projects.length;this.currentProject=this.projects[e]}else t({title:a.result.message,icon:"none"})}catch(s){console.error("提交评分失败:",s),t({title:"提交失败，请重试",icon:"none"})}else t({title:"请完成所有评分",icon:"none"})}},onLoad(){this.loadProjects()}},[["render",function(e,t,I,x,b,v){const g=m,S=r,T=f,k=h,P=y,C=_;return n(),s(S,{class:"container"},{default:a((()=>[c(S,{class:"header uni-card"},{default:a((()=>[c(g,{class:"title"},{default:a((()=>[l("路演评分系统")])),_:1}),b.userInfo.verified?(n(),s(S,{key:0,class:"user-info"},{default:a((()=>[c(g,{class:"user-welcome"},{default:a((()=>[l("欢迎，"+o(b.userInfo.username),1)])),_:1}),c(g,{class:"user-type"},{default:a((()=>[l(o("expert"===b.userInfo.userType?"专家组":"大众组"),1)])),_:1})])),_:1})):i("",!0)])),_:1}),b.userInfo.verified?(n(),s(S,{key:1,class:"scoring-section"},{default:a((()=>[c(S,{class:"section-title"},{default:a((()=>[l("选择项目")])),_:1}),c(C,{class:"project-list","scroll-x":""},{default:a((()=>[(n(!0),u(p,null,d(b.projects,(e=>{var t;return n(),s(S,{key:e.id,class:j(["project-card",{active:(null==(t=b.currentProject)?void 0:t.id)===e.id}]),onClick:t=>v.selectProject(e)},{default:a((()=>[c(g,{class:"project-name"},{default:a((()=>[l(o(e.name),1)])),_:2},1024),c(g,{class:"project-field"},{default:a((()=>[l(o(e.field),1)])),_:2},1024)])),_:2},1032,["class","onClick"])})),128))])),_:1}),b.currentProject?(n(),s(S,{key:0,class:"scoring-form uni-card"},{default:a((()=>[c(S,{class:"project-header"},{default:a((()=>[c(g,{class:"project-title"},{default:a((()=>[l(o(b.currentProject.name),1)])),_:1}),c(g,{class:"project-description"},{default:a((()=>[l(o(b.currentProject.description),1)])),_:1})])),_:1}),c(S,{class:"criteria-list"},{default:a((()=>[(n(!0),u(p,null,d(b.criteria,((e,t)=>(n(),s(S,{key:t,class:"criterion-item"},{default:a((()=>[c(S,{class:"criterion-info"},{default:a((()=>[c(g,{class:"criterion-name"},{default:a((()=>[l(o(e.name),1)])),_:2},1024),c(g,{class:"criterion-desc"},{default:a((()=>[l(o(e.description),1)])),_:2},1024),c(g,{class:"max-score"},{default:a((()=>[l("满分："+o(e.maxScore)+"分",1)])),_:2},1024)])),_:2},1024),c(S,{class:"score-input"},{default:a((()=>[c(T,{type:"number",modelValue:e.score,"onUpdate:modelValue":t=>e.score=t,max:e.maxScore,min:"0",onInput:t=>v.validateScore(e),placeholder:"0",class:"score-input-field"},null,8,["modelValue","onUpdate:modelValue","max","onInput"]),c(g,{class:"score-unit"},{default:a((()=>[l("分")])),_:1})])),_:2},1024)])),_:2},1024)))),128))])),_:1}),c(S,{class:"total-score"},{default:a((()=>[c(g,{class:"total-text"},{default:a((()=>[l("当前总分："+o(v.currentTotalScore)+"分",1)])),_:1}),c(g,{class:"weight-info"},{default:a((()=>[l(o("expert"===b.userInfo.userType?"(专家组权重：60%)":"(大众组权重：40%)"),1)])),_:1})])),_:1}),c(P,{onClick:v.submitScore,disabled:!v.canSubmit,class:"uni-btn uni-btn-success submit-btn"},{default:a((()=>[l(" 提交评分 ")])),_:1},8,["onClick","disabled"])])),_:1})):(n(),s(S,{key:1,class:"no-project"},{default:a((()=>[c(g,null,{default:a((()=>[l("暂无项目数据")])),_:1})])),_:1}))])),_:1})):(n(),s(S,{key:0,class:"auth-section"},{default:a((()=>[c(S,{class:"auth-card uni-card"},{default:a((()=>[c(g,{class:"auth-title"},{default:a((()=>[l("身份验证")])),_:1}),c(S,{class:"input-group"},{default:a((()=>[c(g,{class:"uni-label"},{default:a((()=>[l("姓名：")])),_:1}),c(T,{modelValue:b.usernameInput,"onUpdate:modelValue":t[0]||(t[0]=e=>b.usernameInput=e),class:"uni-input",placeholder:"请输入真实姓名",maxlength:"20"},null,8,["modelValue"])])),_:1}),c(S,{class:"input-group"},{default:a((()=>[c(g,{class:"uni-label"},{default:a((()=>[l("手机号：")])),_:1}),c(T,{modelValue:b.phoneInput,"onUpdate:modelValue":t[1]||(t[1]=e=>b.phoneInput=e),class:"uni-input",placeholder:"请输入手机号",type:"number",maxlength:"11"},null,8,["modelValue"])])),_:1}),c(S,{class:"input-group"},{default:a((()=>[c(g,{class:"uni-label"},{default:a((()=>[l("用户类型：")])),_:1}),c(k,{onChange:v.onUserTypeChange,value:b.userTypeIndex,range:b.userTypes,class:"picker"},{default:a((()=>[c(S,{class:"picker-value"},{default:a((()=>[l(o(b.userTypes[b.userTypeIndex]),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1}),c(P,{onClick:v.verifyIdentity,class:"uni-btn uni-btn-primary"},{default:a((()=>[l("验证身份")])),_:1},8,["onClick"]),c(P,{onClick:v.testConnection,class:"uni-btn uni-btn-warning"},{default:a((()=>[l("测试连接")])),_:1},8,["onClick"])])),_:1})])),_:1}))])),_:1})}],["__scopeId","data-v-7e36e279"]]);export{x as default};
